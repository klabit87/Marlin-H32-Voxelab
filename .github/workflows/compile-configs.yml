name: Build Configs

on:
  release:
    types: [created]

  workflow_dispatch:

jobs:
  Build-Default:
    name: Build Default Files
    runs-on: ubuntu-latest
    strategy:
      matrix:
        chip: [H32]
    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Sync toolchain
      uses: carlosperate/arm-none-eabi-gcc-action@v1

#      id: build_configs
    - name: Compile firmware
      run: |
        echo "filename=Default-NoProbe-${AQUILA_VER}.bin" >> $GITHUB_OUTPUT
        cp firmware/Configuration\ Files/Aquila\ Templates/Default-NoProbe/Configuration.h firmware/Sources/Marlin/Configuration.h
        cp firmware/Configuration\ Files/Aquila\ Templates/Default-NoProbe/Configuration_adv.h firmware/Sources/Marlin/Configuration_adv.h
        cd firmware/Debug
        make all
      env:
        AQUILA_VER: ${{ matrix.chip }}
    - name: Name file accordingly
      env:
        AQUILA_VER: ${{ matrix.chip }}
      run: |
        ls firmware/Debug
        mv firmware/Debug/firmware.bin firmware/Debug/Default-NoProbe-${AQUILA_VER}.bin
        ls firmware/Debug
    - name: Upload to Release
      uses: softprops/action-gh-release@v1
      with:
        files: firmware/Debug/Default-NoProbe-H32.bin
        name: Upload Release Asset-${{ github.run_id }}
        tag_name: ${{ github.run_id }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

